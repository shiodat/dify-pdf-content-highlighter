# dify-pdf-content-highlighter

dify-pdf-content-highlighter は、ウェブページで参照されている PDF 文書内のテキストを自動的にハイライトする Chrome 拡張機能です。特に Dify などの AI アシスタントの会話で参照される PDF ドキュメントの関連部分を素早く見つけるのに役立ちます。

## 機能

- ウェブページから PDF の参照を自動抽出
- 組み込みビューアで PDF をプレビュー
- 関連するコンテンツを PDF 内で自動的にハイライト

## インストール方法

### 事前準備: PDF.js ライブラリの設定

この拡張機能は Mozilla の PDF.js ライブラリを使用しています。以下の手順で PDF.js をインストールしてください：

1. [PDF.js リリースページ](https://github.com/mozilla/pdf.js/releases) から最新の安定版をダウンロード
2. ダウンロードした zip ファイルを解凍
3. 解凍したファイルから以下のディレクトリとファイルをコピー:
   - `build` ディレクトリ全体
   - `web` ディレクトリ全体（オプション、一部の高度な機能に必要）
4. PDF Content Highlighter のディレクトリ内に `pdfjs` フォルダを作成
5. コピーしたファイルを `pdfjs` フォルダに配置

フォルダ構造の例:
```
dify-pdf-content-highlighter/
└── pdfjs/
    ├── build/
    │   ├── pdf.js
    │   ├── pdf.worker.js
    │   └── ...
    └── web/
        ├── viewer.css
        └── ...
```

> **注意**: PDF.js バージョン 2.8.335 以上を使用してください。それより古いバージョンでは一部の機能が動作しない可能性があります。

### 開発者モードでインストール

1. このリポジトリをクローンまたはダウンロード
2. 上記の「PDF.js ライブラリの設定」の手順に従って PDF.js をインストール
3. Chrome で `chrome://extensions/` を開く
4. 右上の「デベロッパーモード」を有効にする
5. 「パッケージ化されていない拡張機能を読み込む」をクリック
6. ダウンロードしたフォルダを選択

## 使い方

1. PDF リファレンスを含むウェブページ（Dify の会話など）を開く
2. Chrome ツールバーの PDF Content Highlighter アイコンをクリック
3. 「Extract PDF References」ボタンをクリックして PDF 参照を抽出
4. ドロップダウンから確認したい PDF を選択
5. PDF がプレビューウィンドウに表示される
6. 「Highlight Content」ボタンをクリックして関連コンテンツをハイライト
7. 必要に応じて「Open in New Tab」ボタンをクリックして PDF を新しいタブで開く

## HTML タグの制約

この拡張機能は、特定の HTML タグ構造を持つウェブページから PDF リファレンスを抽出します。抽出が正常に機能するためには、以下のタグ構造が必要です：

### 必要なタグ構造

```html
<chunk>
  <url>https://example.com/document.pdf</url>
  <content>ハイライトしたいテキスト内容</content>
</chunk>
```

各要素の説明:
- `<chunk>`: 各 PDF 参照を囲むコンテナ要素
- `<url>`: PDF ファイルの URL を含む要素（`.pdf` で終わる必要があります）
- `<content>`: PDF 内でハイライトしたいテキスト内容を含む要素

### サンプル

```html
<div class="conversation">
  <chunk>
    <url>https://example.com/report2023.pdf</url>
    <content>第3四半期の売上は前年比15%増加し、特に海外市場での成長が顕著であった。</content>
  </chunk>

  <p>その他のコンテンツ...</p>

  <chunk>
    <url>https://example.com/financial_analysis.pdf</url>
    <content>投資家向け説明会では、新規事業の展開計画と収益予測について詳細な説明が行われた。</content>
  </chunk>
</div>
```

### 注意事項

- URL は必ず `.pdf` で終わる有効な PDF ファイルへのリンクである必要があります
- 同じ PDF が複数回参照されている場合、それぞれの `<chunk>` タグごとに別々のコンテンツをハイライトできます
- タグは正確に `<chunk>`、`<url>`、`<content>` である必要があります（大文字小文字は区別されます）
- タグのネスト構造は正確に守る必要があります

## 制限事項

- 開発中のため動作保証はできません
- 非常に大きな PDF ファイル（100MB 以上）での処理が遅くなる場合があります
- 一部の高度な PDF 機能（フォーム、署名、暗号化など）はサポートされていません
- 極端に複雑なレイアウトの PDF では、テキスト抽出とハイライトの精度が低下する場合があります

## トラブルシューティング

### PDF.js 関連の問題

1. **PDF が表示されない:**
   - PDF.js が正しくインストールされているか確認
   - `pdfjs/build` ディレクトリに必要なファイルが存在するか確認
   - コンソールでエラーメッセージを確認

2. **テキストが抽出されない:**
   - 最新バージョンの PDF.js を使用しているか確認
   - スキャンされた PDF や画像ベースの PDF はテキスト抽出が困難

3. **ハイライトが機能しない:**
   - PDF のテキストレイヤーが正しく生成されているか確認
   - コンソールでエラーメッセージを確認
